<!DOCTYPE html>
<html lang="fa">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صفحه ناشر</title>
    <link rel="stylesheet" href="/static/css/style.css">
    </style>
</head>

<body>
    <h2>کاربر {{.Name}} خوش آمدید.</h2>
    <h2>دسته بندی: {{.Category}} ~~~ درصد کمیسیون: {{.CommissionPercent}}% ~~~ موجودی: {{.Balance}} تومان</h2>
    <form action="{{.ID}}/checkout" method="post">
        <button type="submit">تسویه حساب</button>
    </form>
    <script>
        function CTR(Click, Impression) {
            if (Impression == 0) return 0;
            return Click / Impression;

        }
    </script>
    <h2>آمار</h2>
    <h3>کلیک: {{.Click}} ~~~
        بازدید: {{.Impression}} ~~~
        CTR:
        <script>document.write(CTR({{.Click }}, {{.Impression }}).toFixed(2))</script>
    </h3>


    <h2>اسکریپت شما</h2>
    <textarea class="prettyprint" rows="10" cols="100"><style> .ad-container { width: 300px; border: 2px solid #ccc; padding: 10px; box-sizing: border-box; text-align: center; background-color: #f8f8f8; margin: 20px auto; } .ad-title { font-size: 18px; margin: 0 0 10px 0; } .ad-image { max-width: 100%; max-height: 150px; object-fit: contain; display: block; margin: 0 auto; } .debug-info { margin-top: 20px; text-align: left; } </style> <div class="ad-container" id="ad-container"> <script> async function fetchAd() { try { const response = await fetch(`{{.ScriptApi}}?publisher_id=${pub_id}&title=${document.title}`); const ad = await response.json(); displayAd(ad); observeAdImpression(ad.impression_url + `?ad_id=${ad.id}&adv_id=${ad.advertiser_id}&pub_id=${pub_id}`); } catch (error) { console.error('Error fetching ad:', error); } } function displayAd(ad) { const adContainer = document.getElementById('ad-container'); adContainer.innerHTML = ` <a href="${ad.click_url}?ad_id=${ad.id}&adv_id=${ad.advertiser_id}&pub_id=${pub_id}&redirect_url=${ad.redirect_url}" target="_blank"> <img src="${ad.image_url}" alt="${ad.title}" class="ad-image"> <h2 class="ad-title">${ad.title}</h2> </a> `; } function observeAdImpression(impressionUrl) { const adContainer = document.getElementById('ad-container'); const observer = new IntersectionObserver(entries => { entries.forEach(entry => { if (entry.isIntersecting) { fetch(impressionUrl); observer.unobserve(adContainer); } }); }, { threshold: 0.5 }); observer.observe(adContainer); } pub_id = {{.ID }}; window.onload = fetchAd; </script>    </textarea>
</body>

</html>